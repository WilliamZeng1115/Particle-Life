<!DOCTYPE html>
<html>
<head>
<title>Particle Life</title>
</style>
</head>

<body>
<canvas class='myCanvas' onclick="updateMouse(event)">
</canvas>

<style>
  body {
    margin: 0;
    overflow: hidden;
  }
</style>

<script>
var canvas = document.querySelector('.myCanvas');
var ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var radius = 4;
var particles = [];
var particlesTemp = [];
class particle {

  constructor(type, x, y) {
    var canvas = document.querySelector('.myCanvas');
    this.ctx = canvas.getContext('2d');
    this.type = type;
    this.x = x;
    this.y = y;

    switch(type){
      case 0:
        this.color = 'rgb(159, 26, 189)'
        break;
      case 1:
        this.color = 'rgb(78, 189, 26)'
        break;
      case 2:
        this.color = 'rgb(17, 242, 250)'
        break;
      case 3:
        this.color = 'rgb(250, 17, 64)'
        break;
      case 4:
        this.color = 'rgb(250, 188, 17)'
        break;
      default:
        this.color = 'rgb(255, 255, 255)'
        break;
      }

    this.ctx.fillStyle = this.color;

    this.velocityx = (Math.random() - 0.5);
    this.velocityy = (Math.random() - 0.5);
  }

  renderImage() {
    this.ctx.beginPath();
    this.ctx.arc(this.x, this.y, radius, 0, 2 * Math.PI);
    this.ctx.fillStyle = this.color;
    this.ctx.fill();
  }

  collisionCheck(){
    for(var i = 0; i < particles.length; i++){
      if(particlesTemp[i] != this && Math.sqrt((this.x - particlesTemp[i].x)**2 + (this.y - particlesTemp[i].y)**2) < radius*2){
        this.velocityx = particlesTemp[i].velocityx;
        this.velocityy = particlesTemp[i].velocityy;
      }

      if(this.x < 4 || this.x > (window.innerWidth - 4)){
        this.velocityx *= -1;
      }

      if(this.y < 4 || this.y > (window.innerHeight - 4)){
        this.velocityy *= -1;
      }
    }
  }

  move() {
    this.collisionCheck();
    this.renderImage();

    this.x += this.velocityx;
    this.y += this.velocityy;
  }
}

function updateMouse(event) {
  var particleBase = new particle(Math.floor(Math.random()*6), event.clientX,  event.clientY);
  particles.push(particleBase);
  particleBase.renderImage();
}

function loop(){
  const context = canvas.getContext('2d');
  context.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'rgb(0, 0, 0)';
  ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
  particlesTemp = particles.slice(0);
  particles.forEach(function(element) {
    element.move();
  });
  requestAnimationFrame(loop);
}

loop();

</script>
</body>
</html>
